# План реализации CapsuleGraph v0.1

Подробное описание архитектуры CapsuleGraph приведено в файле `Roadmap`. Ниже представлен пошаговый план реализации v0.1.
Этот документ фиксирует конкретные шаги по созданию CapsuleGraph. После конвертации исходной модели формируется файл `.cgraph` с полным CapsuleGraph. Из него автоматически строится MiniCapsuleGraph для быстрого вывода. Лёгкая модель находится в памяти и использует индекс связей с полным графом, чтобы при необходимости мгновенно подгружать нужные капсулы. Веса хранятся в memory-mapped файлах, экономя оперативную память.

## Приоритеты
1. **Запуск прототипа** – конвертация моделей в `.cgraph` и выполнение MiniCapsuleGraph на CPU.
2. **Минимальные зависимости** – использовать готовые библиотеки (например, ONNX Runtime) для быстрого старта.
3. **Memory-mapped веса** – хранить веса в mmap-файлах для экономии RAM и быстрой подгрузки.
4. **Кроссплатформенность** – изначально поддерживать Linux и Windows, а в перспективе macOS.
5. **Конкретная схема CapsuleGraph** – точное описание JSON/YAML‑структуры капсулы, версионирование и правила совместимости.
6. **Инструменты автоматизации** – скрипты конвертации, проверок и простой CLI.
7. **Тестирование и профилирование** – короткие тесты и измерение скорости вывода.

## Потенциальные ошибки и пути их решения
- **Несогласованность форматов** – в первых версиях допускаем только проверенные комбинации (gguf/onnx).
- **Недостаток RAM/VRAM** – предоставляем режим частичной загрузки весов и работу с миниграфом.
- **Неудачная оптимизация** – даём возможность откатить изменения, храним полные CapsuleGraph до трансформаций.
- **Невалидный индекс миниграфа** – регулярно проверяем связность MiniCapsuleGraph с полным CapsuleGraph и перегенерируем индекс при несоответствиях.

## Этапы реализации
### Этап 1. Подготовка
1. Организовать структуру репозитория и начальные зависимости.
2. Спроектировать формат `.cgraph`: заголовок, описание капсул, веса, метаданные.
3. Реализовать первичный конвертер из gguf/onnx в `.cgraph`.
4. Добавить прототип разделения файла на полный и мини-граф.
5. Проверить лицензии зависимостей и задокументировать их.

### Этап 2. Минимальный рантайм
1. Рантайм на Python с mmap-загрузкой весов и поддержкой MiniCapsuleGraph.
2. Индекс связей миниграфа с полным CapsuleGraph для быстрого поиска нужных капсул.
3. Механизм подгрузки капсул из полного графа при выводе.
4. Подготовка к последующей оптимизации (C++/CUDA).

### Этап 3. Инструменты
1. CLI `cgraph convert <файл>` – конвертация и разделение модели.
2. CLI `cgraph run <mini.cgraph>` – выполнение вывода.
3. Логирование и отчёты о производительности.
4. Базовый пакет для установки через `pip` и сборка wheels для Linux и Windows.

### Этап 4. Тестирование
1. Набор юнит‑тестов для конвертера и рантайма.
2. Интеграционные тесты на примере небольшой модели.
3. Сравнение скорости и потребления памяти на разных платформах.

### Этап 5. Документация
1. Полное описание формата `.cgraph` и структуры капсулы.
2. Примеры использования CLI и рекомендации по расширению.
3. Инструкция по участию в разработке и оформлению плагинов.

## Дополнительные шаги
- Плагины для аппаратных бэкэндов и оптимизаций.
- Сбор статистики использования (с согласия пользователей) для последующей доработки.
- Налаженный процесс CI для автоматической проверки и сборки пакетов.

## Контрольные точки
- **v0.1-alpha** – работает конвертер и базовый рантайм, CLI выполняет основные команды.
- **v0.1-beta** – стабилизация и оптимизация производительности, добавлены тесты.
- **v0.1** – итоговый выпуск с документацией и возможностью расширения через плагины.

Этот план описывает реальные шаги по созданию CapsuleGraph v0.1 и может служить основой для дальнейшего развития проекта.
